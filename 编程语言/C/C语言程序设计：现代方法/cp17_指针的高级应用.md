# 17 指针的高级应用

## 17.1 动态存储分配

`<stdlib.h>`中三个内存分配函数

- malloc: 分配内存，但不进行初始化
- calloc: 分配内存，并把内存块清零。要清零内存，效率比 malloc 低
- realloc: 调整先前分配的内存块的大小

realloc 的几条规则：

- 新加的内存不会被初始化
- 失败时，返回空指针，原有内存不变
- 若 realloc 的第一个参数是 void * ，则其和 malloc 一样
- 若 realloc 的第二个参数值为0，则其会释放内存

## 17.4 释放存储空间

动态分配的空间在堆（heap）中。C 语言没有 GC，动态分配的内存空间一定要手动释放。

不能再被访问到的内存块称为 garbage。程序出现 garbage 称 memory leak

```c
p = malloc(...);
q = malloc(...);
p = q;              // p 指针指向了 q 指向的空间。p 原来指向的空间变用不了了
```

用 free 函数可以手动释放内存。

```c
p = malloc(...);
q = malloc(...);
free(p);
p = q;
```

free 的参数一定要是指向动态分配的内存的指针。如果是指向普通变量的指针，则会出现未定义行为。
